<?xml version="1.0" encoding="UTF-8"?>
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="reportHistoricoUfMunicipio_disponbilidade" language="groovy" pageWidth="555" pageHeight="802" columnWidth="555" leftMargin="0" rightMargin="0" topMargin="0" bottomMargin="0" uuid="1bac6833-b034-4318-bf6c-e5f49394b8ea">
	<property name="ireport.zoom" value="1.0"/>
	<property name="ireport.x" value="0"/>
	<property name="ireport.y" value="0"/>
	<style name="Crosstab Data Text" hAlign="Center"/>
	<parameter name="cod_municipio" class="java.lang.String"/>
	<parameter name="uf" class="java.lang.String"/>
	<parameter name="municipio" class="java.lang.String"/>
	<parameter name="tipos" class="java.util.Collection"/>
	<queryString>
		<![CDATA[select * from (
select
  sg_uf as sg_uf,
  no_cod_municipio_ibge as no_cod_municipio_ibge,
  no_municipio as no_municipio,
  no_prestadora as no_prestadora,
  (case
      when right(in_mes_ano,2) = '01' then 'JAN-' || left(in_mes_ano,4)
      when right(in_mes_ano,2) = '02' then 'FEV-'  || left(in_mes_ano,4)
      when right(in_mes_ano,2) = '03' then 'MAR-'  || left(in_mes_ano,4)
      when right(in_mes_ano,2) = '04' then 'ABR-'  || left(in_mes_ano,4)
      when right(in_mes_ano,2) = '05' then 'MAI-'  || left(in_mes_ano,4)
      when right(in_mes_ano,2) = '06' then 'JUN-'  || left(in_mes_ano,4)
      when right(in_mes_ano,2) = '07' then 'JUL-' || left(in_mes_ano,4)
      when right(in_mes_ano,2) = '08' then 'AGO-'  || left(in_mes_ano,4)
      when right(in_mes_ano,2) = '09' then 'SET-'  || left(in_mes_ano,4)
      when right(in_mes_ano,2) = '10' then 'OUT-'  || left(in_mes_ano,4)
      when right(in_mes_ano,2) = '11' then 'NOV-'  || left(in_mes_ano,4)
      when right(in_mes_ano,2) = '12' then 'DEZ-'  || left(in_mes_ano,4)
      else 'OUT-'  || left(in_mes_ano,4)
   end
  ) as in_mes_ano,
  100*cast(left(in_mes_ano,4) as integer) + cast(right(in_mes_ano,2) as integer)  as orig_in_mes_ano,
  nu_disponibilidade as nu_disponibilidade,
  'DISPONIBILIDADE' as tipo,
  '98 %' as referencia_disponibilidade
from
  tb_historico_disponibilidade
where
  no_cod_municipio_ibge = $P{cod_municipio} and
  sg_uf = $P{uf}
union
select
  $P{uf} as sg_uf,
  $P{cod_municipio} as no_cod_municipio_ibge,
  $P{municipio} as no_municipio,
  prestadoras.no_prestadora as no_prestadora,
  (case
      when right(meses.in_mes_ano,2) = '01' then 'JAN-' || left(meses.in_mes_ano,4)
      when right(meses.in_mes_ano,2) = '02' then 'FEV-'  || left(meses.in_mes_ano,4)
      when right(meses.in_mes_ano,2) = '03' then 'MAR-'  || left(meses.in_mes_ano,4)
      when right(meses.in_mes_ano,2) = '04' then 'ABR-'  || left(meses.in_mes_ano,4)
      when right(meses.in_mes_ano,2) = '05' then 'MAI-'  || left(meses.in_mes_ano,4)
      when right(meses.in_mes_ano,2) = '06' then 'JUN-'  || left(meses.in_mes_ano,4)
      when right(meses.in_mes_ano,2) = '07' then 'JUL-' || left(meses.in_mes_ano,4)
      when right(meses.in_mes_ano,2) = '08' then 'AGO-'  || left(meses.in_mes_ano,4)
      when right(meses.in_mes_ano,2) = '09' then 'SET-'  || left(meses.in_mes_ano,4)
      when right(meses.in_mes_ano,2) = '10' then 'OUT-'  || left(meses.in_mes_ano,4)
      when right(meses.in_mes_ano,2) = '11' then 'NOV-'  || left(meses.in_mes_ano,4)
      when right(meses.in_mes_ano,2) = '12' then 'DEZ-'  || left(meses.in_mes_ano,4)
      else 'OUT-'  || left(meses.in_mes_ano,4)
   end
  ) as in_mes_ano,
  100*cast(left(meses.in_mes_ano,4) as integer) + cast(right(meses.in_mes_ano,2) as integer)  as orig_in_mes_ano,
  0.0 as nu_disponibilidade,
  'DISPONIBILIDADE' as tipo,
  '98 %' as referencia_disponibilidade
From
(select distinct no_prestadora from tb_historico_disponibilidade where no_cod_municipio_ibge = $P{cod_municipio} and
  sg_uf = $P{uf}) as prestadoras,
(select distinct in_mes_ano from tb_historico_disponibilidade where no_cod_municipio_ibge = $P{cod_municipio} and
  sg_uf = $P{uf}) as meses
) linhas
where $X{IN;tipo;tipos}
order by no_prestadora, orig_in_mes_ano]]>
	</queryString>
	<field name="sg_uf" class="java.lang.String"/>
	<field name="no_cod_municipio_ibge" class="java.lang.String"/>
	<field name="no_municipio" class="java.lang.String"/>
	<field name="no_prestadora" class="java.lang.String"/>
	<field name="in_mes_ano" class="java.lang.String"/>
	<field name="orig_in_mes_ano" class="java.lang.Integer"/>
	<field name="nu_disponibilidade" class="java.lang.Double"/>
	<field name="tipo" class="java.lang.String"/>
	<field name="referencia_disponibilidade" class="java.lang.String"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<summary>
		<band height="109">
			<textField>
				<reportElement positionType="Float" x="94" y="11" width="373" height="20" uuid="8ac8e8fd-1651-4348-a86b-ac2f69c0cf1e"/>
				<textElement textAlignment="Center">
					<font size="12" isBold="true"/>
				</textElement>
				<textFieldExpression><![CDATA["Disponibilidade (%)"]]></textFieldExpression>
			</textField>
			<crosstab ignoreWidth="true">
				<reportElement positionType="Float" x="0" y="31" width="555" height="55" uuid="b6e7023c-1044-424b-99df-23ee460d376d"/>
				<crosstabDataset isDataPreSorted="true"/>
				<crosstabHeaderCell>
					<cellContents>
						<staticText>
							<reportElement style="Crosstab Data Text" x="0" y="0" width="70" height="20" uuid="c5dfd51c-c638-4134-9b4d-5b0941a13b6c"/>
							<box>
								<pen lineWidth="1.0"/>
								<topPen lineWidth="1.0"/>
								<leftPen lineWidth="1.0"/>
								<bottomPen lineWidth="1.0"/>
								<rightPen lineWidth="1.0"/>
							</box>
							<textElement>
								<font size="8" isBold="true"/>
							</textElement>
							<text><![CDATA[Prestadora]]></text>
						</staticText>
					</cellContents>
				</crosstabHeaderCell>
				<rowGroup name="no_prestadora" width="70">
					<bucket class="java.lang.String">
						<bucketExpression><![CDATA[$F{no_prestadora}]]></bucketExpression>
					</bucket>
					<crosstabRowHeader>
						<cellContents backcolor="#FFFFFF" mode="Opaque">
							<box>
								<pen lineWidth="0.5" lineStyle="Solid" lineColor="#FFFFFF"/>
							</box>
							<textField>
								<reportElement style="Crosstab Data Text" x="0" y="0" width="70" height="20" uuid="bc0991d3-2983-4198-8d04-4b6fd95c6262"/>
								<box>
									<pen lineWidth="1.0"/>
									<topPen lineWidth="1.0"/>
									<leftPen lineWidth="1.0"/>
									<bottomPen lineWidth="1.0"/>
									<rightPen lineWidth="1.0"/>
								</box>
								<textElement>
									<font size="8" isBold="true"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{no_prestadora}]]></textFieldExpression>
							</textField>
						</cellContents>
					</crosstabRowHeader>
					<crosstabTotalRowHeader>
						<cellContents/>
					</crosstabTotalRowHeader>
				</rowGroup>
				<columnGroup name="in_mes_ano" height="20">
					<bucket class="java.lang.String">
						<bucketExpression><![CDATA[$F{in_mes_ano}]]></bucketExpression>
					</bucket>
					<crosstabColumnHeader>
						<cellContents backcolor="#FFFFFF" mode="Opaque">
							<box>
								<pen lineWidth="0.5" lineStyle="Solid" lineColor="#FFFFFF"/>
							</box>
							<textField>
								<reportElement style="Crosstab Data Text" x="0" y="0" width="40" height="20" uuid="8f24d0e0-a9bb-4205-b025-02624082385b"/>
								<box>
									<pen lineWidth="1.0"/>
									<topPen lineWidth="1.0"/>
									<leftPen lineWidth="1.0"/>
									<bottomPen lineWidth="1.0"/>
									<rightPen lineWidth="1.0"/>
								</box>
								<textElement>
									<font size="8" isBold="true"/>
								</textElement>
								<textFieldExpression><![CDATA[$V{in_mes_ano}]]></textFieldExpression>
							</textField>
						</cellContents>
					</crosstabColumnHeader>
					<crosstabTotalColumnHeader>
						<cellContents/>
					</crosstabTotalColumnHeader>
				</columnGroup>
				<measure name="nu_disponibilidadeMeasure" class="java.lang.Double" calculation="Sum">
					<measureExpression><![CDATA[$F{nu_disponibilidade}]]></measureExpression>
				</measure>
				<crosstabCell width="40" height="20">
					<cellContents>
						<box>
							<pen lineWidth="0.5" lineStyle="Solid" lineColor="#FFFFFF"/>
						</box>
						<textField>
							<reportElement style="Crosstab Data Text" x="0" y="0" width="40" height="20" uuid="c23b6c78-fb17-4f8b-89c9-05c6175cf345"/>
							<box>
								<pen lineWidth="1.0"/>
								<topPen lineWidth="1.0"/>
								<leftPen lineWidth="1.0"/>
								<bottomPen lineWidth="1.0"/>
								<rightPen lineWidth="1.0"/>
							</box>
							<textElement>
								<font size="8"/>
							</textElement>
							<textFieldExpression><![CDATA[$V{nu_disponibilidadeMeasure} == 0.0 ? "-" : $V{nu_disponibilidadeMeasure}]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell height="20" rowTotalGroup="no_prestadora">
					<cellContents backcolor="#FFBFBF" mode="Opaque">
						<box>
							<pen lineWidth="0.5" lineStyle="Solid" lineColor="#FFFFFF"/>
						</box>
						<textField>
							<reportElement style="Crosstab Data Text" x="0" y="0" width="40" height="20" uuid="cb661c36-1c67-4222-8ef2-3cd9e7fb762d"/>
							<textFieldExpression><![CDATA[$V{nu_disponibilidadeMeasure}]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell width="40" columnTotalGroup="in_mes_ano">
					<cellContents backcolor="#FFBFBF" mode="Opaque">
						<box>
							<pen lineWidth="0.5" lineStyle="Solid" lineColor="#FFFFFF"/>
						</box>
						<textField>
							<reportElement style="Crosstab Data Text" x="0" y="0" width="40" height="20" uuid="7880e991-a346-4d7a-bb6f-4ef1c665e0b7"/>
							<textFieldExpression><![CDATA[$V{nu_disponibilidadeMeasure}]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
				<crosstabCell rowTotalGroup="no_prestadora" columnTotalGroup="in_mes_ano">
					<cellContents backcolor="#FFBFBF" mode="Opaque">
						<box>
							<pen lineWidth="0.5" lineStyle="Solid" lineColor="#FFFFFF"/>
						</box>
						<textField>
							<reportElement style="Crosstab Data Text" x="0" y="0" width="40" height="20" uuid="54ca420e-9127-4ab6-8084-b4748ac683b5"/>
							<textFieldExpression><![CDATA[$V{nu_disponibilidadeMeasure}]]></textFieldExpression>
						</textField>
					</cellContents>
				</crosstabCell>
			</crosstab>
		</band>
	</summary>
</jasperReport>
